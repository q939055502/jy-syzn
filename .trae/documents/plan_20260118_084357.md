# 1. 添加文件格式验证

## 1.1 修改文件工具函数

* 更新 `app/services/detection/utils/file_utils.py`，添加文件格式验证函数

* 只允许 `.doc`、`.docx`、`.xls`、`.xlsx` 四种格式

## 1.2 修改服务层代码

* 更新 `app/services/detection/delegation_form_template_service.py` 中的 `create` 方法，添加文件格式验证

* 更新 `update` 方法，添加文件格式验证

## 1.3 修改路由层代码

* 更新 `app/routes/detection/templates.py` 中的 `create_template` 端点，添加文件格式验证

* 更新 `update_template` 端点，添加文件格式验证

# 2. 编写测试脚本

## 2.1 创建测试脚本

* 在 `tests` 目录下创建 `test_delegation_form_template.py` 文件

* 编写测试用例，测试创建和更新功能

* 测试四种允许的文件格式

* 测试其他格式，确保被拒绝

## 2.2 测试用例设计

* 测试创建功能，使用四种测试文件

* 测试更新功能，使用四种测试文件

* 测试创建功能，使用不允许的文件格式（如 `.pdf`）

* 测试更新功能，使用不允许的文件格式

# 3. 执行测试

## 3.1 运行测试脚本

* 执行 `python -m pytest tests/test_delegation_form_template.py -v`

* 查看测试结果

## 3.2 手动测试

* 使用 API 测试工具（如 Postman）测试创建功能

* 使用 API 测试工具测试更新功能

* 测试四种允许的文件格式

* 测试其他格式，确保被拒绝

# 4. 验证文件保存

## 4.1 检查文件是否正确保存

* 检查 `static/templates` 目录下是否有创建的文件

* 检查文件路径是否正确

* 检查文件内容是否完整

## 4.2 验证更新功能

* 更新模板，检查文件是否正确更新

* 检查旧文件是否被删除

* 检查新文件是否正确保存

# 5. 验证跨平台兼容性

* 确保文件路径使用了跨平台的 `pathlib` 库

* 确保路径分隔符没有写死

通过以上步骤，我将验证委托单模板的创建和更新功能是否正常，同时确保只接受指定的四种文件格式。

管理员账号密码都是：aaa
