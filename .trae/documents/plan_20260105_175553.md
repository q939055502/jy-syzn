# 删除规范错误处理修复计划

## 1. 问题分析
从日志可以看出：
- 错误消息：`规范ID 1 被 2 个检测项目组使用，无法删除`
- 预期状态码：400（因为包含"被使用"的业务逻辑错误）
- 实际状态码：500（服务器内部错误）

## 2. 根本原因
当前代码使用了错误的字符串匹配方式：
- 代码检查：`if "被使用" in error:`
- 但实际错误消息：`规范ID 1 被 2 个检测项目组使用，无法删除`
- 问题：`被使用`不是连续子串，中间有空格和数字

## 3. 修复方案
修改错误处理逻辑，使用更准确的字符串匹配：
1. 检查错误消息中是否包含"不存在" → 返回404
2. 检查错误消息中是否包含"引用"或"使用" → 返回400
3. 其他错误 → 返回500

## 4. 预期效果
- 当规范被引用时：返回400状态码和具体错误信息
- 当规范被使用时：返回400状态码和具体错误信息
- 当规范不存在时：返回404状态码
- 其他错误：返回500状态码

## 5. 实现步骤
1. 修改路由层错误处理逻辑
2. 保持现有代码风格
3. 确保错误匹配准确

## 6. 代码示例
修改前：
```python
if error:
    if "不存在" in error:
        raise HTTPException(status_code=404, detail=error)
    if "被引用" in error:
        raise HTTPException(status_code=400, detail=error)
    if "被使用" in error:
        raise HTTPException(status_code=400, detail=error)
    raise HTTPException(status_code=500, detail=error)
```

修改后：
```python
if error:
    if "不存在" in error:
        raise HTTPException(status_code=404, detail=error)
    if "引用" in error or "使用" in error:
        raise HTTPException(status_code=400, detail=error)
    raise HTTPException(status_code=500, detail=error)
```