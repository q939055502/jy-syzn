# 删除标准错误处理修复计划

## 1. 问题分析

从终端日志可以看出：

* 错误消息：`规范ID 1 被 2 个检测项目组使用，无法删除`

* 预期状态码：400（因为这是业务逻辑错误，标准被使用）

* 实际状态码：500（服务器内部错误）

## 2. 根本原因

当前代码使用了正确的字符串匹配逻辑，但存在一个关键问题：

* 代码：`if "引用" in error or "使用" in error:`

* 但返回500错误表明这个条件没有匹配成功

* 可能的原因：`error` 不是字符串类型，或者匹配逻辑存在问题

## 3. 修复方案

修改错误处理逻辑，使其更健壮：

1. 确保 `error` 是字符串类型
2. 使用更简单的匹配条件：检查 "无法删除" 关键字
3. 保持与现有代码风格一致

## 4. 预期效果

* 当标准被使用时，返回400状态码和具体错误信息

* 当标准不存在时，返回404状态码

* 其他错误，返回500状态码

## 5. 实现步骤

1. 修改路由层错误处理逻辑
2. 确保 `error` 是字符串类型
3. 使用更简单的匹配条件
4. 保持现有代码风格

## 6. 代码示例

修改前：

```python
if error:
    print(f"Delete standard error: {error}")
    if "不存在" in error:
        raise HTTPException(status_code=404, detail=error)
    if "引用" in error or "使用" in error:
        raise HTTPException(status_code=400, detail=error)
    raise HTTPException(status_code=500, detail=error)
```

修改后：

```python
if error:
    print(f"Delete standard error: {error}")
    error_str = str(error)
    if "不存在" in error_str:
        raise HTTPException(status_code=404, detail=error_str)
    if "无法删除" in error_str:
        raise HTTPException(status_code=400, detail=error_str)
    raise HTTPException(status_code=500, detail=error_str)
```

