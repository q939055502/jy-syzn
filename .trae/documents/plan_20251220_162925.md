# 目录结构优化计划

## 1. 问题分析
- **服务层与数据访问层使用不一致**：有些服务直接访问数据库，有些通过DAL层
- **Redis工具方法名不统一**：工具类使用`set_cache/get_cache`，但有些地方使用了`set/get`
- **目录结构不够清晰**：缺少明确的领域划分，DAL层和服务层的组织方式不一致

## 2. 优化目标
- 统一服务层访问数据的方式，所有服务通过DAL层访问数据
- 统一Redis工具方法名，以`redis_utils.py`中的方法名为准
- 优化目录结构，使各层职责明确，组织方式一致

## 3. 优化方案

### 3.1 统一Redis工具方法名
- 修改所有使用Redis工具的地方，使用`redis_utils.py`中定义的方法名：`set_cache`、`get_cache`、`delete_cache`
- 移除之前添加的`get/set/delete`别名，保持工具类的方法名一致性

### 3.2 统一服务层访问方式
- 修改所有直接访问数据库的服务，改为通过DAL层访问
- 为所有模型创建对应的DAL类，确保数据访问的一致性
- 确保所有服务都通过依赖注入获取数据库和Redis连接

### 3.3 优化目录结构
- 保持现有分层架构（服务层 → 数据访问层 → 工具层）
- 确保所有服务都放在对应的领域子目录中
- 确保所有DAL类都放在dal目录及其子目录中
- 统一依赖注入的方式，确保服务层只依赖于DAL层，不直接依赖于底层工具

## 4. 实现步骤
1. **修改redis_utils.py**：移除`get/set/delete`别名，只保留`set_cache/get_cache/delete_cache`方法
2. **修改服务层**：将所有直接访问数据库的服务改为通过DAL层访问
3. **创建缺失的DAL类**：为所有模型创建对应的DAL类
4. **修改现有DAL类**：确保所有DAL类使用正确的Redis工具方法名
5. **修改服务层**：确保所有服务使用正确的Redis工具方法名

## 5. 预期效果
- 目录结构清晰，各层职责明确
- 服务层统一通过DAL层访问数据
- Redis工具方法名统一，使用`set_cache/get_cache/delete_cache`
- 各层之间的依赖关系清晰，符合分层架构原则

## 6. 注意事项
- 确保修改过程中保持代码的可运行性
- 确保所有测试通过
- 确保数据一致性
- 确保依赖注入的正确性