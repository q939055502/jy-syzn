# 检测模块改进计划

## 1. 修复模型层次结构问题

### 1.1 更新DetectionItem模型相关代码
- **更新DetectionItemService**：将所有category_id引用改为object_id
- **移除过时方法**：删除add_standard和remove_standard方法，因为检测项目与检测规范的直接关联已被移除
- **更新数据验证逻辑**：将分类存在性检查改为检测对象存在性检查

### 1.2 更新Schema定义
- **更新DetectionItemBase**：将category_id字段改为object_id
- **更新DetectionItemCreate/Update/Response**：同步更新所有DetectionItem相关的schema

### 1.3 更新DAL层
- **添加DetectionObjectDAL**：在detection_dal.py中添加检测对象的数据访问层
- **更新base_dal.py**：添加DetectionObject的主键处理逻辑

## 2. 完善检测对象的CRUD实现

### 2.1 添加DetectionObjectService
- **实现基本CRUD方法**：get_all、get_by_id、create、update、delete
- **添加业务逻辑**：检测对象名称唯一性验证、分类关联检查

### 2.2 添加DetectionObject路由
- **实现RESTful API**：/objects、/objects/{object_id}
- **支持所有CRUD操作**：GET、POST、PUT、DELETE

## 3. 完善其他模型的服务实现

### 3.1 更新DetectionParamService
- **确保与新模型层次兼容**：检查并更新所有关联逻辑
- **添加参数关联管理**：实现检测参数与规范、模板的关联管理

### 3.2 更新DetectionStandardService
- **确保与新模型层次兼容**：检查并更新所有关联逻辑
- **添加规范管理功能**：规范替代关系管理

### 3.3 更新DelegationFormTemplateService
- **确保与新模型层次兼容**：检查并更新所有关联逻辑
- **添加模板管理功能**：模板版本管理、默认模板设置

## 4. 测试和验证

### 4.1 单元测试
- **测试所有服务方法**：确保所有CRUD操作正常工作
- **测试业务逻辑**：验证数据验证、关联检查等逻辑

### 4.2 集成测试
- **测试API端点**：确保所有路由正常响应
- **测试数据流向**：验证数据从API到数据库的完整流程

## 5. 代码清理

### 5.1 删除过时文件
- **删除旧的模型文件**：检测guide相关的旧文件
- **清理导入语句**：移除所有未使用的导入

### 5.2 优化代码结构
- **统一代码风格**：确保所有代码遵循相同的风格
- **优化注释**：更新所有注释以反映当前的模型结构

## 6. 文档更新

### 6.1 更新模型说明文档
- **确保文档准确**：验证模型关系图和描述与实际代码一致
- **添加API文档**：为所有新添加的API端点添加文档

## 7. 部署和验证

### 7.1 运行初始化脚本
- **初始化数据库**：确保所有表和关系正确创建
- **添加测试数据**：添加必要的测试数据用于验证

### 7.2 启动应用程序
- **测试应用启动**：确保应用程序正常启动
- **验证API响应**：测试所有API端点的响应

通过以上改进，将确保检测模块的代码符合新的模型层次结构，业务逻辑完整，API端点齐全，并且能够正常运行。