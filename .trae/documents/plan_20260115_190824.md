# 修复并完善用户数据初始化脚本

## 问题分析

1. **外键约束冲突**：当前脚本在删除数据时遇到外键约束问题，无法正确删除 `category` 表和 `detection_group` 表的数据
2. **删除顺序错误**：没有按照正确的依赖关系顺序删除表数据
3. **表不存在处理**：没有正确处理表不存在的情况

## 修复方案

1. **优化删除逻辑**：
   - 使用更安全的方式处理外键约束
   - 按照正确的依赖关系顺序删除表数据
   - 为每个删除操作添加 try-except 块，处理表不存在的情况

2. **修改删除顺序**：
   - 先删除所有关联表数据
   - 然后删除主表数据
   - 最后删除分类表数据

3. **确保表创建**：
   - 确保脚本能够成功创建数据库和表
   - 确保测试数据能够成功写入

## 实现步骤

1. **修改 init_user_data.py**：
   - 重新设计数据删除逻辑，使用更安全的方式处理外键约束
   - 按照正确的依赖关系顺序删除表数据
   - 为每个删除操作添加 try-except 块

2. **优化删除顺序**：
   - 先删除委托单模板表数据
   - 然后删除检测指南关联表数据
   - 接着删除检测指南表数据
   - 然后删除检测规范表数据
   - 接着删除检测参数表数据
   - 然后删除检测项目表数据
   - 接着删除检测项目规范关联表数据
   - 然后删除检测项目组规范关联表数据
   - 接着删除检测项目组表数据
   - 最后删除分类表数据

3. **确保表创建和数据初始化**：
   - 确保脚本能够成功创建数据库和表
   - 确保测试数据能够成功写入

## 预期结果

- 脚本能够成功执行，删除所有现有数据
- 脚本能够成功创建数据库和表
- 脚本能够成功写入测试数据
- 所有外键约束问题得到解决

## 技术要点

- 使用 try-except 块处理表不存在的情况
- 按照正确的依赖关系顺序删除表数据
- 确保脚本能够成功创建数据库和表
- 确保测试数据能够成功写入