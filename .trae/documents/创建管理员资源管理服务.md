# 管理员资源管理服务实现计划

## 1. 目录结构设计

创建管理员服务模块，位于`app/services/admin/`目录下：

```
app/
├── services/
│   ├── admin/             # 新增：管理员服务目录
│   │   ├── __init__.py     # 管理员服务包初始化
│   │   └── detection_admin_service.py  # 检测相关资源管理服务
│   ├── detection/         # 已存在：检测服务
│   └── user/              # 已存在：用户服务
```

## 2. 实现内容

### 2.1 检测资源管理服务

在`app/services/admin/detection_admin_service.py`中实现以下功能：

#### 检测规范批量操作
- `batch_create_standards`: 批量创建检测规范
- `batch_update_standards`: 批量更新检测规范
- `batch_delete_standards`: 批量删除检测规范
- `batch_download_standards`: 批量下载检测规范（CSV格式）
- `import_standards`: 从CSV文件导入检测规范
- `export_standards`: 导出检测规范到CSV文件

#### 检测项目批量操作
- `batch_create_items`: 批量创建检测项目
- `batch_update_items`: 批量更新检测项目
- `batch_delete_items`: 批量删除检测项目
- `batch_download_items`: 批量下载检测项目（CSV格式）

#### 检测指南批量操作
- `batch_create_guides`: 批量创建检测指南
- `batch_update_guides`: 批量更新检测指南
- `batch_delete_guides`: 批量删除检测指南

#### 委托单模板批量操作
- `batch_create_templates`: 批量创建委托单模板
- `batch_update_templates`: 批量更新委托单模板
- `batch_delete_templates`: 批量删除委托单模板

### 2.2 核心技术要点

1. **事务管理**：批量操作使用数据库事务，确保原子性
2. **数据验证**：对批量数据进行严格验证，返回详细错误信息
3. **文件处理**：使用Python内置`csv`模块处理CSV文件，支持导入导出
4. **错误处理**：详细的错误信息，包括行号和具体错误原因
5. **性能优化**：批量操作使用高效的数据库插入方式
6. **权限考虑**：设计为管理员专用，后续可集成权限控制

### 2.3 方法签名设计

```python
# 批量创建检测规范
def batch_create_standards(standards_data: List[dict]) -> Tuple[List[DetectionStandard], List[dict]]

# 批量下载检测规范
def batch_download_standards(standard_ids: List[int]) -> Tuple[str, bytes]

# 从CSV导入检测规范
def import_standards(file_path: str) -> Tuple[int, List[dict]]

# 导出检测规范到CSV
def export_standards(standard_ids: Optional[List[int]] = None) -> Tuple[str, bytes]
```

## 3. 实现步骤

1. 创建`app/services/admin/`目录和初始化文件
2. 实现`detection_admin_service.py`中的批量操作方法
3. 更新`__init__.py`导出新服务
4. 添加必要的依赖（如需要）
5. 测试功能完整性

## 4. 预期效果

- 管理员可以批量管理所有检测相关资源
- 支持从CSV文件导入导出数据，方便数据迁移和备份
- 批量操作有详细的错误信息，便于调试
- 事务保证数据一致性
- 代码结构清晰，便于扩展其他资源的批量操作

## 5. 依赖说明

- 使用Python内置`csv`模块处理文件，无需额外安装依赖
- 依赖现有的检测服务类，调用其单个操作方法

## 6. 后续扩展

- 可以扩展到其他模块的批量操作
- 集成权限验证，确保只有管理员可以使用
- 支持更多文件格式，如Excel、JSON
- 添加数据统计和报告生成功能
