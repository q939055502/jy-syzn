# 添加委托单模板编号属性实现计划

## 1. 模型修改
- **文件**: `app/models/detection/delegation_form_template.py`
- **修改内容**: 在`DelegationFormTemplate`类中添加`template_code`字段
  - 类型: `String(50)`
  - 约束: `unique=True, nullable=True`
  - 注释: 模板编号
  - 更新`to_dict()`方法，包含新字段

## 2. 初始化脚本更新
- **文件**: `script/init_all.py`
- **修改内容**: 
  - 在`init_detection_data()`函数的模板初始化部分，为每个模板添加`template_code`属性
  - 示例值: `SNT-2024-001`、`GJT-2024-001`

## 3. 业务逻辑更新
- **查找**: 使用`Grep`工具查找所有涉及委托单模板增删改查的文件
- **修改**: 
  - 确保所有创建模板的地方支持`template_code`参数
  - 确保所有更新模板的地方支持`template_code`参数
  - 确保所有查询模板的地方包含`template_code`字段
  - 确保所有返回模板数据的地方包含`template_code`字段

## 4. API文档更新
- **文件**: `API接口说明.md`
- **修改内容**: 
  - 在模板相关接口的请求和响应示例中添加`template_code`字段
  - 包括:
    - 3.5.1 获取委托单模板列表
    - 3.5.2 获取单个委托单模板
    - 3.5.3 创建委托单模板
    - 3.5.4 更新委托单模板

## 5. 执行步骤
1. 执行第1步，修改模型文件
2. 执行第2步，更新初始化脚本
3. 运行初始化脚本: `python script/init_all.py`
4. 执行第3步，更新业务逻辑
5. 执行第4步，更新API文档
6. 测试所有模板相关接口，确保功能正常

## 6. 代码风格要求
- 保持与现有代码一致的缩进和命名规范
- 遵循SQLAlchemy的最佳实践
- 确保注释清晰、准确
- 保持API文档的格式一致性

## 7. 测试要求
- 运行初始化脚本后，检查数据库表结构是否包含新字段
- 测试模板创建功能，验证`template_code`是否被正确保存
- 测试模板更新功能，验证`template_code`是否可以被修改
- 测试模板查询功能，验证返回结果是否包含`template_code`字段
- 测试唯一性约束，确保无法创建重复的`template_code`