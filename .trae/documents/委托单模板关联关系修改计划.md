# 委托单模板关联关系修改计划

## 1. 模型修改

### 1.1 DelegationFormTemplate模型修改

* 移除`item_id`字段和关联关系

* 移除`is_default`字段

* 更新表结构和相关方法

### 1.2 DetectionParam模型修改

* 移除`is_required`字段

* 移除`price_note`字段

* 移除`sample_video_path`字段

- 将多对多关系改为多对一关系：添加`template_id`外键关联委托单模板

- 更新`to_dict`方法，移除多对多关系的处理

### 1.3 中间表修改

* 删除`DetectionParamTemplate`中间表，因为不再需要多对多关系

## 2. 数据访问层(DAL)修改

### 2.1 DelegationFormTemplateDAL修改

* 移除`get_by_item_id`方法

* 移除`get_default_by_item_id`方法

* 更新`search`方法，移除基于item\_id的搜索

### 2.2 DetectionParamDAL修改

* 更新查询方法，支持通过template\_id过滤

* 更新搜索方法，支持基于template的搜索

## 3. 服务层(Service)修改

### 3.1 DelegationFormTemplateService修改

* 移除`get_by_item_id`方法

* 移除`get_default_by_item_id`方法

* 更新`create`和`update`方法，移除item\_id和is\_default的处理

### 3.2 DetectionParamService修改

* 更新`create`和`update`方法，处理template\_id关联

* 更新关联关系的处理逻辑

## 4. 路由层(Router)修改

### 4.1 templates.py修改

* 更新路由处理，移除item\_id和is\_default相关逻辑

* 更新请求参数验证

### 4.2 params.py修改

* 更新路由处理，支持template\_id关联

## 5. 数据传输对象(Schema)修改

### 5.1 detection.py修改

* 更新`DelegationFormTemplateBase`，移除item\_id和is\_default字段

* 更新`DetectionParamBase`，添加template\_id字段

* 更新响应模型，反映新的关联关系

## 6. 初始化脚本修改

### 6.1 init\_all.py修改

* 更新初始化数据，移除item\_id、is\_default、is\_required、price\_note、sample\_video\_path相关设置

* 更新模型关联逻辑，使用新的多对一关系

## 7. 说明文档修改

### 7.1 模型说明.md修改

* 更新模型关系图

* 更新模型关系说明

### 7.2 API接口说明.md修改

* 更新API文档，移除tem\_id、is\_default、is\_required、price\_note、sample\_video\_path相关参数

* 更新请求和响应示例

### 7.3 后端修改说明.md创建

* 记录本次修改的详细内容

## 8. 测试

### 8.1 数据库初始化

* 运行初始化脚本，重建库表和数据

### 8.2 API测试

* 测试委托单模板的CRUD操作

* 测试检测参数与委托单模板的关联操作

## 修改文件列表

1. `app/models/detection/delegation_form_template.py`
2. `app/models/detection/detection_param.py`
3. `app/models/associations.py`
4. `app/dal/detection_dal.py`
5. `app/routes/detection/templates.py`
6. `app/routes/detection/params.py`
7. `app/schemas/detection.py`
8. `app/services/detection/delegation_form_template_service.py`
9. `app/services/detection/detection_param_service.py`
10. `script/init_all.py`
11. `API接口说明.md`
12. `app/models/模型说明.md`
13. `后端修改说明.md`

