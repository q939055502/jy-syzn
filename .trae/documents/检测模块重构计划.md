# 检测模块重构计划

## 重构目标
将"检测项目组"改为"检测项目"，将"检测项目"改为"检测参数"，涉及所有相关的模型、路由、服务、文档等。

## 重构范围
1. **模型层**：修改核心模型类名、表名、字段名和关系
2. **关联表**：更新多对多关联表的名称和外键
3. **路由层**：更新路由路径和处理函数
4. **服务层**：更新服务类和方法
5. **数据访问层**：更新DAL类和方法
6. **模式层**：更新Pydantic模型
7. **文档**：更新API文档和模型说明
8. **测试**：编写测试脚本验证重构效果

## 重构步骤

### 1. 模型层重构
- **创建新模型文件**：
  - `detection_item_new.py`：将原`detection_group.py`重命名并修改为新的检测项目模型
  - `detection_param.py`：将原`detection_item.py`重命名并修改为检测参数模型
- **修改模型内容**：
  - 更新类名：`DetectionGroup` → `DetectionItem`，`DetectionItem` → `DetectionParam`
  - 更新表名：`detection_group` → `detection_item`，`detection_item` → `detection_param`
  - 更新主键字段：`group_id` → `item_id`，`item_id` → `param_id`
  - 更新外键关系：`group_id` → `item_id`
  - 更新关系定义：`detection_items` → `detection_params`

### 2. 关联表重构
- **修改`associations.py`**：
  - 更新`DetectionGroupStandard` → `DetectionItemStandard`，外键`group_id` → `item_id`
  - 更新`DetectionItemGuide` → `DetectionParamGuide`，外键`item_id` → `param_id`
  - 更新中间表名和字段名

### 3. 更新`__init__.py`文件
- **修改`app/models/detection/__init__.py`**：
  - 移除旧模型导入
  - 添加新模型导入
  - 更新`__all__`列表

### 4. 数据访问层重构
- **修改`app/dal/detection_dal.py`**：
  - 更新类名和方法名
  - 更新数据库查询逻辑
  - 更新表名和字段名引用

### 5. 服务层重构
- **修改`app/services/detection/`目录下的服务文件**：
  - 更新服务类名和方法名
  - 更新服务逻辑中的模型引用
  - 更新数据库操作调用

### 6. 路由层重构
- **修改`app/routes/detection/`目录下的路由文件**：
  - 更新路由路径：`/groups` → `/items`，`/items` → `/params`
  - 更新路由处理函数
  - 更新请求和响应模型

### 7. 模式层重构
- **修改`app/schemas/detection.py`**：
  - 更新Pydantic模型名：`DetectionGroup` → `DetectionItem`，`DetectionItem` → `DetectionParam`
  - 更新模型字段名
  - 更新响应模型

### 8. 更新API文档
- **修改`API_DOCUMENTATION.md`**：
  - 更新接口路径和描述
  - 更新请求和响应示例
  - 更新参数说明

### 9. 更新模型说明文档
- **修改`app/models/detection/模型说明.md`**：
  - 更新模型名称和描述
  - 更新表关系图
  - 更新模型文件列表

### 10. 测试验证
- **创建测试脚本**：
  - 测试模型创建和查询
  - 测试API接口
  - 测试关联关系
- **运行测试**：确保所有功能正常

## 注意事项
1. 重构前备份数据库和代码
2. 按照依赖关系顺序进行重构
3. 每次修改后运行测试验证
4. 确保所有命名保持一致
5. 更新所有相关的注释和文档

## 预期效果
- 完成"检测项目组"到"检测项目"，"检测项目"到"检测参数"的完整重构
- 所有API接口正常工作
- 数据库表结构正确更新
- 文档与代码保持一致
- 测试通过